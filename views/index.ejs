<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>votes</title>
</head>
<body>
    <div class="container">
        <div class="voting-section">
            <h2>Crear un nuevo tema</h2>
            <form id="create-topic-form">
                <label for="topic-title">Tema:</label>
                <input type="text" id="topic-title" name="topic-title" required>
                <label for="topic-content">Contenido:</label>
                <textarea id="topic-content" name="topic-content" required></textarea>
                <button type="submit">Crear Tema</button>
            </form>
            <h2>Top videogames</h2>
            <% if (topTopics && topTopics.length > 0) { %>
                <ol>
                    <% topTopics.forEach(topic => { %>
                        <li><%= topic.title %> - Votes: <span id="vote-count-<%= topic.id %>"><%= topic.votes %></span></li>
                    <% }); %>
                </ol>
            <% } else { %>
                <p>No topics available.</p>
            <% } %>
            <h2>All Topics</h2>
            <ul>
                <% topics.forEach(topic => { %>
                    <li>
                        <%= topic.title %> - <span id="vote-count-<%= topic.id %>"><%= topic.votes %></span> votos
                        <button onclick="voteForTopic(<%= topic.id %>)">Vote</button>
                    </li>
                <% }); %>
            </ul>
            <script>
                async function voteForTopic(topicId) {
                    try{
                        console.log("el topicId es: ", topicId)
                        const response = await fetch(`/topic/${topicId}`, {
                            method: 'PATCH',
                            headers: {
                                'Content-Type': 'application/json'
                            }})

                        if (response.ok){
                            const result = await response.json()
                            console.log(result.message)

                            const voteCountElem = document.getElementById(`vote-count-${topicId}`)
                            voteCountElem.textContent = parseInt(voteCountElem.textContent) + 1

                            alert("voto registrado exitosamente")
                        } else {
                            const error = await response.json()
                            console.log(error.message)
                            alert("Error al votar")
                        }
                    } catch(err){
                        console.log("Ocurrio un problema al intentar votar ", err)
                    }              
                }
            </script>            
        </div> 
</body>
</html>
